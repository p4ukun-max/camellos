<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Carrera Reyes Magos</title>

<style>
* { box-sizing: border-box; }

html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  overflow: hidden;        /* ðŸ”¥ elimina scroll */
  touch-action: none;      /* ðŸ”¥ bloquea gestos nativos */
  overscroll-behavior: none;
}

.game {
  display: flex;
  flex-direction: column;
  align-items: center;
  height: 100vh;
}

/* -------- CARRERA -------- */
.race {
  width: 95%;
  margin: 10px 0;
}
.lane {
  height: 80px;
  border-bottom: 2px dashed #aaa;
  position: relative;
}
.camel {
  position: absolute;
  left: 0;
  height: 100%;
  transition: left 0.4s;
}
.camel img {
  height: 100%;
}

/* -------- TABLERO -------- */
.board {
  position: relative;
  width: 95%;
  max-width: 420px;
  aspect-ratio: 3/4;
  background: radial-gradient(#8b0000, #400);
  border: 5px solid gold;
  border-radius: 20px;
  overflow: hidden;
}

.row {
  display: flex;
  justify-content: center;
  margin: 4%;
}
.row.double { justify-content: space-evenly; }
.row.triple { justify-content: space-around; }

.hole {
  width: 12vw;
  max-width: 55px;
  aspect-ratio: 1;
  background: radial-gradient(#000, #111);
  border-radius: 50%;
  box-shadow: inset 0 0 10px #000, 0 0 8px gold;
}

/* -------- ZONA LANZAMIENTO -------- */
.launch-zone {
  position: absolute;
  bottom: 0;
  width: 100%;
  height: 20%;
  border-top: 2px dashed #aaa;
}

.ball {
  width: 9vw;
  max-width: 34px;
  aspect-ratio: 1;
  border-radius: 50%;
  position: absolute;
  cursor: grab;
  touch-action: none;  
  will-change: transform;
  user-select: none;
}
.info {
  margin: 10px;
  font-size: 18px;
}
</style>
</head>

<body>
<div class="game">

  <div class="race">
    <div class="lane">
      <div class="camel" id="camel-diana"><img src="camello1.png"></div>
    </div>
    <div class="lane">
      <div class="camel" id="camel-pau"><img src="camello2.png"></div>
    </div>
  </div>

  <div class="board" id="board">
    <div class="row single">
      <div class="hole" data-points="30"></div>
    </div>
    <div class="row double">
      <div class="hole" data-points="20"></div>
      <div class="hole" data-points="20"></div>
    </div>
    <div class="row triple">
      <div class="hole" data-points="10"></div>
      <div class="hole" data-points="10"></div>
      <div class="hole" data-points="10"></div>
    </div>

    <div class="launch-zone"></div>
    <div class="ball" id="ball"></div>
  </div>

  <div class="info">Turno: <span id="turn">Diana</span></div>
</div>

<script>
const board = document.getElementById("board");
const ball = document.getElementById("ball");
const holes = document.querySelectorAll(".hole");
const turnText = document.getElementById("turn");

const players = [
  {name:"Diana", score:0, camel:"camel-diana", color:"#4da6ff"},
  {name:"Pau", score:0, camel:"camel-pau", color:"#ff4d4d"}
];
let dragX = 0, dragY = 0;
let current = 0;
let ballX=0, ballY=0, velX=0, velY=0;
let animating=false, dragging=false;
let startX=0, startY=0;

// ðŸ”§ FÃSICA OPTIMIZADA PARA MÃ“VIL
const gravity  = 0.18;
const bounce   = 0.65;
const friction = 0.985;
const POWER    = 0.07;
const GOAL     = 100;

function resetBall(){
  animating=false;
  velX=velY=0;

  const b = board.getBoundingClientRect();
  ballX = b.width/2 - ball.offsetWidth/2;
  ballY = b.height - b.height*0.15;

  ball.style.left = ballX+"px";
  ball.style.top  = ballY+"px";
}

function nextTurn(){
  if(players[current].score >= GOAL){
    alert(players[current].name+" gana ðŸŽ‰");
    location.reload();
  }
  current = (current+1)%players.length;
  turnText.textContent = players[current].name;
  ball.style.background = players[current].color;
}

function score(p){
  const pl = players[current];
  pl.score += p;
  document.getElementById(pl.camel).style.left = (pl.score/GOAL*90)+"%";
}

function checkCollision(){
  const bRect = board.getBoundingClientRect();
  const bx = ballX + ball.offsetWidth/2;
  const by = ballY + ball.offsetHeight/2;

  holes.forEach(h=>{
    const r = h.getBoundingClientRect();
    const hx = r.left - bRect.left + r.width/2;
    const hy = r.top  - bRect.top  + r.height/2;

    const dist = Math.hypot(bx-hx, by-hy);
    if(dist < r.width*0.4){
      score(+h.dataset.points);
      resetBall();
      nextTurn();
    }
  });
}

function animate(){
  if(!animating) return;

  velY += gravity;
  velX *= 0.995;

  ballX += velX;
  ballY += velY;

  const w = board.clientWidth;
  const h = board.clientHeight;

  if(ballX < 0 || ballX > w - ball.offsetWidth) velX *= -bounce;
  if(ballY < 0 || ballY > h - ball.offsetHeight){
    velY *= -bounce;
    velX *= friction;
  }

  ballX = Math.max(0, Math.min(w - ball.offsetWidth, ballX));
  ballY = Math.max(0, Math.min(h - ball.offsetHeight, ballY));

  ball.style.left = ballX + "px";
  ball.style.top  = ballY + "px";

  checkCollision();

  if(Math.abs(velX) < 0.1 && Math.abs(velY) < 0.1){
    resetBall();
    nextTurn();
    return;
  }

  requestAnimationFrame(animate);
}

// ðŸŽ¯ CONTROLES TÃCTILES RESPONSIVOS
ball.addEventListener("pointerdown", e => {
  if (animating) return;
  dragging = true;

  const rect = board.getBoundingClientRect();
  startX = e.clientX - rect.left;
  startY = e.clientY - rect.top;

  dragX = ballX;
  dragY = ballY;

  ball.setPointerCapture(e.pointerId);
});

document.addEventListener("pointermove", e => {
  if (!dragging) return;

  const rect = board.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  // desplazamiento limitado (no dejar sacarla del tablero)
  const maxDrag = board.clientWidth * 0.25;

  let dx = x - startX;
  let dy = y - startY;

  const dist = Math.hypot(dx, dy);
  if (dist > maxDrag) {
    dx = dx / dist * maxDrag;
    dy = dy / dist * maxDrag;
  }

  ballX = dragX + dx;
  ballY = dragY + dy;

  ballX = Math.max(0, Math.min(board.clientWidth - ball.offsetWidth, ballX));
  ballY = Math.max(0, Math.min(board.clientHeight - ball.offsetHeight, ballY));

  ball.style.left = ballX + "px";
  ball.style.top  = ballY + "px";
});
document.addEventListener("pointerup", e => {
  if (!dragging) return;
  dragging = false;

  const rect = board.getBoundingClientRect();
  const endX = e.clientX - rect.left;
  const endY = e.clientY - rect.top;

  const scale = board.clientWidth / 400;

  velX = (endX - startX) * POWER * scale;
  velY = (endY - startY) * POWER * scale;

  // ðŸ‘‡ SOLO si no hay lanzamiento real
  if (Math.abs(velX) + Math.abs(velY) < 1) {
    resetBall();
    return;
  }

  // ðŸ”¥ MUY IMPORTANTE:
  // ballX y ballY YA estÃ¡n donde el usuario la dejÃ³
  animating = true;
  animate();
});
resetBall();
ball.style.background = players[0].color;
</script>
</body>
</html>
