<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carrera Reyes Magos</title>
  <style>
  body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: radial-gradient(#1e1e3f, #000);
  color: white;
}

.game {
  height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.goal {
  margin: 10px 0;
  font-size: 22px;
}

.race {
  width: 90%;
  height: 200px;
  border: 2px solid white;
  margin-bottom: 10px;
}

.lane {
  height: 66px;
  border-bottom: 1px dashed #aaa;
  position: relative;
}

.camel {
  position: absolute;
  left: 0;
  top: 22px;
  font-size: 20px;
  transition: left 0.4s;
}

.blue { color: #4da6ff; }
.red { color: #ff4d4d; }
.green { color: #4dff88; }

/* TABLERO */
.board {
  width: 100%;
  padding: 30px 0;
}

.row {
  display: flex;
  justify-content: center;
  margin: 25px 0; 
}

.row.double {
  justify-content: space-evenly;
}

.row.triple {
  justify-content: space-around;
}

.hole {
  width: 50px;     
  height: 50px;
  background: radial-gradient(#000, #222);
  border-radius: 50%;
}

/* ZONA DE LANZAMIENTO */
.launch-zone {
  position: relative;
  width: 100%;
  height: 160px; /* espacio para lanzar */
  border-top: 2px dashed #555;
  display: flex;
  justify-content: center;
  align-items: flex-end;
}

.ball {
  width: 30px;
  height: 30px;
  background: #4da6ff;
  border-radius: 50%;
  position: absolute;
  bottom: 18px;
}

/* INFO */
.info {
  margin: 10px 0;
  font-size: 18px;
}
.launch-zone {
  position: relative;
  width: 100%;
  height: 220px;          /* M√ÅS ESPACIO */
  border-top: 3px dashed #777;
  display: flex;
  justify-content: center;
  align-items: flex-end;
}

.launch-line {
  position: absolute;
  top: 30px;
  width: 100%;
  height: 2px;
  background: rgba(255,255,255,0.4);
}

.ball {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  position: absolute;
  bottom: 20px;
  touch-action: none;
}

  </style>
</head>
<body>

<div class="game">

  <div class="goal">üèÅ META</div>

  <!-- CARRERA -->
  <div class="race">
    <div class="lane"><div class="camel blue" id="camel-melchor">üê™</div></div>
    <div class="lane"><div class="camel red" id="camel-gaspar">üê™</div></div>
    <div class="lane"><div class="camel green" id="camel-baltasar">üê™</div></div>
  </div>

  <!-- TABLERO -->
  <div class="board">

    <!-- FILA 1 -->
    <div class="row single">
      <div class="hole" data-points="30"></div>
    </div>

    <!-- FILA 2 -->
    <div class="row double">
      <div class="hole" data-points="20"></div>
      <div class="hole" data-points="20"></div>
    </div>

    <!-- FILA 3 -->
    <div class="row triple">
      <div class="hole" data-points="10"></div>
      <div class="hole" data-points="10"></div>
      <div class="hole" data-points="10"></div>
    </div>

  </div>
	<div class="launch-zone">
	  <div class="launch-line"></div>
	  <div class="ball" id="ball"></div>
	</div>
  <div class="info">
    Turno: <span id="turn">Melchor</span>
  </div>

</div>

<script>const goal = 100;
let originX = 0;
let originY = 0;
let current = 0;
let dragging = false;
let startY;

const players = [
  { name: "Melchor", score: 0, camel: "camel-melchor", color: "#4da6ff" },
  { name: "Gaspar", score: 0, camel: "camel-gaspar", color: "#ff4d4d" },
  { name: "Baltasar", score: 0, camel: "camel-baltasar", color: "#4dff88" }
];

const ball = document.getElementById("ball");
const holes = document.querySelectorAll(".hole");
const turnText = document.getElementById("turn");

ball.style.background = players[0].color;

function shootBall(dx, dy) {
  const power = 2.2;   // m√°s fuerza
  const vx = dx * power;
  const vy = dy * power;

  ball.style.transition = "transform 0.8s cubic-bezier(.15,.85,.25,1)";
  ball.style.transform = `translate(${vx}px, ${vy}px)`;

  setTimeout(() => {
    checkCollision();
    resetBall();
    nextTurn();
  }, 800);
}

function checkCollision() {
  const ballRect = ball.getBoundingClientRect();

  holes.forEach(hole => {
    const holeRect = hole.getBoundingClientRect();

    const hit =
      ballRect.left < holeRect.right &&
      ballRect.right > holeRect.left &&
      ballRect.top < holeRect.bottom &&
      ballRect.bottom > holeRect.top;

    if (hit) {
      score(parseInt(hole.dataset.points));
    }
  });
}

function score(points) {
  const player = players[current];
  player.score += points;

  const progress = Math.min(player.score / goal, 1);
  document.getElementById(player.camel).style.left = `${progress * 90}%`;
}

function nextTurn() {
  if (players[current].score >= goal) {
    alert(`üèÜ ${players[current].name} gana`);
    location.reload();
    return;
  }

  current = (current + 1) % players.length;
  updateTurn();
}

function updateTurn() {
  turnText.innerText = players[current].name;
  ball.style.background = players[current].color;
}

function resetBall() {
  setTimeout(() => {
    ball.style.transition = "none";
    ball.style.transform = "translateY(0)";
  }, 200);
}

let startX;
let launchLineY;
let maxDrag = 120; // distancia m√°xima de arrastre

ball.addEventListener("pointerdown", e => {
  dragging = true;
  startX = e.clientX;
  startY = e.clientY;

  const rect = ball.getBoundingClientRect();
  originX = rect.left;
  originY = rect.top;

  ball.setPointerCapture(e.pointerId);
});
document.addEventListener("pointermove", e => {
  if (!dragging) return;

  let dx = e.clientX - startX;
  let dy = e.clientY - startY;

  // ‚ùå NO permitir arrastrar m√°s all√° de la l√≠nea
  const futureTop = originY + dy;
  if (futureTop < launchLineY) {
    dy = launchLineY - originY;
  }

  // Limitar distancia m√°xima
  const dist = Math.sqrt(dx*dx + dy*dy);
  const maxDrag = 120;
  if (dist > maxDrag) {
    const r = maxDrag / dist;
    dx *= r;
    dy *= r;
  }

  ball.style.transform = `translate(${dx}px, ${dy}px)`;
});
document.addEventListener("pointerup", () => {
  if (!dragging) return;
  dragging = false;

  const transform = ball.style.transform;
  const match = /translate\(([-\d.]+)px,\s*([-\d.]+)px\)/.exec(transform);

  let dx = match ? parseFloat(match[1]) : 0;
  let dy = match ? parseFloat(match[2]) : 0;

  shootBall(dx, dy);
});

</script>
</body>
</html>
