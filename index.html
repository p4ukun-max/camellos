<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carrera Reyes Magos</title>
  <style>
  body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: radial-gradient(#1e1e3f, #000);
  color: white;
}

.game {
  height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.goal {
  margin: 10px 0;
  font-size: 22px;
}

.race {
  width: 90%;
  height: 200px;
  border: 2px solid white;
  margin-bottom: 10px;
}

.lane {
  height: 66px;
  border-bottom: 1px dashed #aaa;
  position: relative;
}

.camel {
  position: absolute;
  left: 0;
  top: 8px;
  height: 50px;
  transition: left 0.4s;
}

.camel img {
  height: 100%;
  width: auto;
  display: block;
  pointer-events: none;
}

.blue { color: #4da6ff; }
.red { color: #ff4d4d; }
.green { color: #4dff88; }

/* TABLERO */
.board {
  position: relative;
  width: 100%;
  height: 420px;        /* espacio para lanzar + agujeros */
  padding: 30px 0;
  overflow: hidden;    /* 游 CLAVE: no se puede salir */
}
.row {
  display: flex;
  justify-content: center;
  margin: 25px 0; 
  pointer-events: none;
}

.row.double {
  justify-content: space-evenly;
}

.row.triple {
  justify-content: space-around;
}

.hole {
  width: 50px;     
  height: 50px;
  background: radial-gradient(#000, #222);
  border-radius: 50%;
    pointer-events: auto;

}

/* ZONA DE LANZAMIENTO */
.launch-zone {
  position: relative;
  width: 100%;
  height: 160px; /* espacio para lanzar */
  border-top: 2px dashed #555;
  display: flex;
  justify-content: center;
  align-items: flex-end;
}

.ball {
  width: 30px;
  height: 30px;
  background: #4da6ff;
  border-radius: 50%;
  position: absolute;
  bottom: 18px;
}

/* INFO */
.info {
  margin: 10px 0;
  font-size: 18px;
}
.launch-zone {
  position: relative;
  width: 100%;
  height: 220px;          /* M츼S ESPACIO */
  border-top: 3px dashed #777;
  display: flex;
  justify-content: center;
  align-items: flex-end;
}

.launch-line {
  position: absolute;
  top: 30px;
  width: 100%;
  height: 2px;
  background: rgba(255,255,255,0.4);
}
.ball {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  position: absolute;
  left: 0;
  top: 0;
  touch-action: none;
}
  </style>
</head>
<body>

<div class="game">

  <div class="goal">游끠 META</div>

  <!-- CARRERA -->
  <div class="race">
	<div class="lane">
	  <div class="camel blue" id="camel-melchor">
		<img src="camello1.png" alt="Camello Melchor">
	  </div>
	</div>
    <div class="lane"><div class="camel red" id="camel-gaspar">游냙</div></div>
    <div class="lane"><div class="camel green" id="camel-baltasar">游냙</div></div>
  </div>

  <!-- TABLERO -->
  <div class="board">

    <!-- FILA 1 -->
    <div class="row single">
      <div class="hole" data-points="30"></div>
    </div>

    <!-- FILA 2 -->
    <div class="row double">
      <div class="hole" data-points="20"></div>
      <div class="hole" data-points="20"></div>
    </div>

    <!-- FILA 3 -->
    <div class="row triple">
      <div class="hole" data-points="10"></div>
      <div class="hole" data-points="10"></div>
      <div class="hole" data-points="10"></div>
    </div>

	  <div class="ball" id="ball"></div>
  </div>
  <div class="info">
    Turno: <span id="turn">Melchor</span>
  </div>

</div>

<script>
let startBallX = 0;
let startBallY = 0;
const goal = 100;
let originX = 0;
let originY = 0;
let current = 0;
let dragging = false;
let startY;
let posX = 0;
let posY = 0;
let ballX, ballY;
let velX = 0, velY = 0;
let animating = false;

const gravity = 0.25;
const bounce = 0.75;
const friction = 0.995;

const players = [
  { name: "Melchor", score: 0, camel: "camel-melchor", color: "#4da6ff" },
  { name: "Gaspar", score: 0, camel: "camel-gaspar", color: "#ff4d4d" },
  { name: "Baltasar", score: 0, camel: "camel-baltasar", color: "#4dff88" }
];
const board = document.querySelector(".board");
const ball = document.getElementById("ball");
const holes = document.querySelectorAll(".hole");
const turnText = document.getElementById("turn");

ball.style.background = players[0].color;

function shootBall(dx, dy) {
  const power = 2.2;   // m치s fuerza
  const vx = dx * power;
  const vy = dy * power;

  ball.style.transition = "transform 0.8s cubic-bezier(.15,.85,.25,1)";
  ball.style.transform = "none";
  
  setTimeout(() => {
    checkCollision();
    resetBall();
    nextTurn();
  }, 800);
}
function attractToHole(hole, hx, hy) {
  animating = false;

  const ballRadius = ball.offsetWidth / 2;

  const dx = hx - (ballX + ballRadius);
  const dy = hy - (ballY + ballRadius);

  ball.style.transition = "transform 0.35s ease-in";
  ball.style.transform = `
    translate(${dx}px, ${dy}px)
    scale(0.3)
  `;
  setTimeout(() => {
    score(parseInt(hole.dataset.points));
    resetBall();
    nextTurn();
  }, 350);
}
function enterHole(hole) {
  animating = false;

  ball.style.transition = "transform 0.2s ease-in";
	ball.style.transform = "scale(0.1)";
  setTimeout(() => {
    score(parseInt(hole.dataset.points));
    resetBall();
    nextTurn();
  }, 200);
}

function checkCollision() {
  const ballRadius = ball.offsetWidth / 2;

  const ballCX = ballX + ballRadius;
  const ballCY = ballY + ballRadius;

  holes.forEach(hole => {
    const holeX = hole.offsetLeft + hole.offsetWidth / 2;
    const holeY = hole.offsetTop + hole.offsetHeight / 2;
    const holeRadius = hole.offsetWidth / 2;

    const dx = ballCX - holeX;
    const dy = ballCY - holeY;
    const dist = Math.hypot(dx, dy);

    if (dist < holeRadius * 0.55) {
      enterHole(hole);
    } else if (dist < holeRadius + ballRadius * 0.4) {
      attractToHole(hole, holeX, holeY);
    }
  });
}

function score(points) {
  const player = players[current];
  player.score += points;

  const progress = Math.min(player.score / goal, 1);
  document.getElementById(player.camel).style.left = `${progress * 90}%`;
}

function nextTurn() {
  if (players[current].score >= goal) {
    alert(`游끥 ${players[current].name} gana`);
    location.reload();
    return;
  }

  current = (current + 1) % players.length;
  updateTurn();
}

function updateTurn() {
  turnText.innerText = players[current].name;
  ball.style.background = players[current].color;
}

function resetBall() {
  animating = false;
  velX = velY = 0;

  const boardRect = board.getBoundingClientRect();
  const ballRect = ball.getBoundingClientRect();

  ballX = boardRect.width / 2 - ballRect.width / 2;
  ballY = boardRect.height - ballRect.height - 20;

  ball.style.left = ballX + "px";
  ball.style.top  = ballY + "px";

  // 游댠 CLAVE ABSOLUTA
  ball.style.transform = `
    translate(${dx}px, ${dy}px)
    scale(1)
  `;
}

let startX;
let launchLineY;
let maxDrag = 120; // distancia m치xima de arrastre

ball.addEventListener("pointerdown", e => {
  if (animating) return;

  dragging = true;
  startX = e.clientX;
  startY = e.clientY;
  startBallX = ballX;
  startBallY = ballY;

  ball.setPointerCapture(e.pointerId);
});
document.addEventListener("pointermove", e => {
  if (!dragging) return;

  let dx = e.clientX - startX;
  let dy = e.clientY - startY;

  const maxDrag = 120;
  const d = Math.hypot(dx, dy);
  if (d > maxDrag) {
    const r = maxDrag / d;
    dx *= r;
    dy *= r;
  }

  // 游댠 actualizar posici칩n REAL
  ballX = startBallX + dx;
  ballY = startBallY + dy;

  ball.style.left = ballX + "px";
  ball.style.top  = ballY + "px";
});
document.addEventListener("pointerup", e => {
  if (!dragging) return;
  dragging = false;

  const dx = startBallX - ballX;
  const dy = startBallY - ballY;

  const distance = Math.hypot(dx, dy);
  if (distance < 5) return;

  const maxPull = 120;
  const maxSpeed = 7;

  const power = Math.min(distance / maxPull, 1);

  const dirX = dx / distance;
  const dirY = dy / distance;

  // 游댠 AQU칈 est치 la clave
  velX = dirX * maxSpeed * power;
  velY = dirY * maxSpeed * power * 1.6; // 游댠 boost vertical

  animating = true;
  animateBall();
});
function animateBall() {
  if (!animating) return;

  velY += gravity;

  ballX += velX;
  ballY += velY;

  const r = ball.offsetWidth;
  const bw = board.clientWidth;
  const paddingBottom = 30;
  const bh = board.clientHeight - paddingBottom;
  // paredes laterales
  if (ballX <= 0) {
    ballX = 0;
    velX *= -bounce;
  }
  if (ballX + r >= bw) {
    ballX = bw - r;
    velX *= -bounce;
  }

  // suelo
  if (ballY + r >= bh) {
    ballY = bh - r;
    velY *= -bounce;
    velX *= friction;
  }

  ball.style.left = ballX + "px";
  ball.style.top = ballY + "px";

  checkCollision();

  if (Math.abs(velX) < 0.1 && Math.abs(velY) < 0.1 && ballY > bh - r - 5) {
    resetBall();
    nextTurn();
    return;
  }

  requestAnimationFrame(animateBall);
}
function resetBall() {
  animating = false;
  velX = velY = 0;

  const boardRect = board.getBoundingClientRect();
  const ballRect = ball.getBoundingClientRect();

  ballX = boardRect.width / 2 - ballRect.width / 2;
  ballY = boardRect.height - ballRect.height - 20;

  ball.style.left = ballX + "px";
  ball.style.top = ballY + "px";
}
resetBall();
</script>
</body>
</html>
