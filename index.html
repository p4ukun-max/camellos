<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Carrera Reyes Magos</title>

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: radial-gradient(#1e1e3f, #000);
  color: white;
  touch-action: none;
  overscroll-behavior: none;
}

.game {
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
}

/* -------- CARRERA -------- */
.race {
  width: 95%;
  margin: 10px 0;
}
.lane {
  height: 80px;
  border-bottom: 2px dashed #aaa;
  position: relative;
}
.camel {
  position: absolute;
  left: 0;
  height: 100%;
  transition: left 0.4s;
}
.camel img {
  height: 100%;
}

/* -------- TABLERO -------- */
.board {
  position: relative;
  width: 95%;
  max-width: 420px;
  aspect-ratio: 3/4;
  background: radial-gradient(#8b0000, #400);
  border: 5px solid gold;
  border-radius: 20px;
  overflow: hidden;
}

.row {
  display: flex;
  justify-content: center;
  margin: 4%;
}
.row.double { justify-content: space-evenly; }
.row.triple { justify-content: space-around; }

.hole {
  width: 12vw;
  max-width: 55px;
  aspect-ratio: 1;
  background: radial-gradient(#000, #111);
  border-radius: 50%;
  box-shadow: inset 0 0 10px #000, 0 0 8px gold;
}

/* -------- ZONA LANZAMIENTO -------- */
.launch-zone {
  position: absolute;
  bottom: 0;
  width: 100%;
  height: 20%;
  border-top: 2px dashed #aaa;
}

.ball {
  width: 9vw;
  max-width: 34px;
  aspect-ratio: 1;
  border-radius: 50%;
  position: absolute;
  cursor: grab;
  touch-action: none;
}

.info {
  margin: 10px;
  font-size: 18px;
}
</style>
</head>

<body>
<div class="game">

  <div class="race">
    <div class="lane">
      <div class="camel" id="camel-diana"><img src="camello1.png"></div>
    </div>
    <div class="lane">
      <div class="camel" id="camel-pau"><img src="camello2.png"></div>
    </div>
  </div>

  <div class="board" id="board">
    <div class="row single">
      <div class="hole" data-points="30"></div>
    </div>
    <div class="row double">
      <div class="hole" data-points="20"></div>
      <div class="hole" data-points="20"></div>
    </div>
    <div class="row triple">
      <div class="hole" data-points="10"></div>
      <div class="hole" data-points="10"></div>
      <div class="hole" data-points="10"></div>
    </div>

    <div class="launch-zone"></div>
    <div class="ball" id="ball"></div>
  </div>

  <div class="info">Turno: <span id="turn">Diana</span></div>
</div>

<script>
const board = document.getElementById("board");
const ball = document.getElementById("ball");
const holes = document.querySelectorAll(".hole");
const turnText = document.getElementById("turn");

const players = [
  {name:"Diana", score:0, camel:"camel-diana", color:"#4da6ff"},
  {name:"Pau", score:0, camel:"camel-pau", color:"#ff4d4d"}
];

let current = 0;
let ballX=0, ballY=0, velX=0, velY=0;
let animating=false, dragging=false;
let startX=0, startY=0;

const gravity=0.35, bounce=0.7, friction=0.98, POWER=0.25, GOAL=100;

function resetBall(){
  animating=false;
  velX=velY=0;
  const b = board.getBoundingClientRect();
  ballX = b.width/2 - ball.offsetWidth/2;
  ballY = b.height - b.height*0.15;
  ball.style.left = ballX+"px";
  ball.style.top = ballY+"px";
}

function nextTurn(){
  if(players[current].score >= GOAL){
    alert(players[current].name+" gana ðŸŽ‰");
    location.reload();
  }
  current = (current+1)%players.length;
  turnText.textContent = players[current].name;
  ball.style.background = players[current].color;
}

function score(p){
  const pl = players[current];
  pl.score += p;
  document.getElementById(pl.camel).style.left = (pl.score/GOAL*90)+"%";
}

function checkCollision(){
  const bRect = board.getBoundingClientRect();
  const bx = ballX + ball.offsetWidth/2;
  const by = ballY + ball.offsetHeight/2;

  holes.forEach(h=>{
    const r = h.getBoundingClientRect();
    const hx = r.left - bRect.left + r.width/2;
    const hy = r.top - bRect.top + r.height/2;
    const dist = Math.hypot(bx-hx, by-hy);
    if(dist < r.width*0.4){
      score(+h.dataset.points);
      resetBall();
      nextTurn();
    }
  });
}

function animate(){
  if(!animating) return;
  velY+=gravity;
  ballX+=velX; ballY+=velY;

  const w=board.clientWidth, h=board.clientHeight;
  if(ballX<0||ballX>w-ball.offsetWidth) velX*=-bounce;
  if(ballY<0||ballY>h-ball.offsetHeight){ velY*=-bounce; velX*=friction; }

  ballX=Math.max(0,Math.min(w-ball.offsetWidth,ballX));
  ballY=Math.max(0,Math.min(h-ball.offsetHeight,ballY));

  ball.style.left=ballX+"px";
  ball.style.top=ballY+"px";

  checkCollision();

  if(Math.abs(velX)<0.1 && Math.abs(velY)<0.1){
    resetBall(); nextTurn(); return;
  }
  requestAnimationFrame(animate);
}

ball.addEventListener("pointerdown",e=>{
  if(animating) return;
  dragging=true;
  startX=e.clientX; startY=e.clientY;
  ball.setPointerCapture(e.pointerId);
});

document.addEventListener("pointerup",e=>{
  if(!dragging) return;
  dragging=false;
  velX=(startX-e.clientX)*POWER;
  velY=(startY-e.clientY)*POWER;
  if(Math.abs(velX)+Math.abs(velY)<3) return resetBall();
  animating=true;
  animate();
});

resetBall();
ball.style.background=players[0].color;
</script>
</body>
</html>
